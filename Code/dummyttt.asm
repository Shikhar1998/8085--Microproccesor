;LOCATIONS:
CODE	.EQU 0000H
;CODE:
	.ORG CODE
	LXI SP,0000H ;STACK INITIALISATION
	CALL INIT
	CALL UPDATE
	MVI B,09H
	MVI A,0AAH
CONTINUE:	RAR
	CALL PLAYERMOVE
	CALL UPDATE
	DCR B
	JNZ CONTINUE
	HLT
;FUNCTIONS:
;---------------------------------------
CWIN:	LXI D,WINLIST
	MVI A,08H
	DCX D
CLOOP:	PUSH PSW
	XRA A
	INX D
	PUSH H
	MVI B,00H
	XCHG
	MOV C,M
	XCHG
	DAD B
	ADD M
	XCHG
	INX H
	MOV C,M
	XCHG
	DAD B
	ADD M
	XCHG
	INX H
	MOV C,M
	XCHG
	DAD B
	ADD M
	POP H ;RESTORING HL
	CPI 0FDH
	JZ WINO
	CPI 03H
	JZ WINX
	POP PSW ;RESTORING A	
	DCR A
	JNZ CLOOP	
	MVI A,00H
		RET
WINO:	POP PSW ;BALANCING THE STACK
	MVI A,0FFH
	RET
WINX:	POP PSW ;BALANCING THE STACK
	MVI A,01H
	RET
;---------------------------------------
UPDATE:	PUSH PSW
	PUSH H
	LXI H,BOARD
	MOV A,M
	OUT 00H
	INX H
	MOV A,M
	OUT 01H
	INX H
	MOV A,M
	OUT 02H
	INX H
	MOV A,M
	OUT 10H
	INX H
	MOV A,M
	OUT 11H
	INX H
	MOV A,M
	OUT 12H
	INX H
	MOV A,M
	OUT 20H
	INX H
	MOV A,M
	OUT 21H
	INX H
	MOV A,M
	OUT 22H
	POP H
	POP PSW
	RET
;----------------------------------------
PLAYERMOVE:
	PUSH PSW
	LXI H,BOARD
	PUSH D
	MVI D,00H
	IN 80H
	MOV E,A
	DAD D
	POP D
	MOV A,M
	CPI 00H
	JNZ INVALID
	;HL IS STILL POINTING TO EXACT POSITION:
	POP PSW
	JC XMOVE
	JNC YMOVE
XMOVE:	PUSH PSW
	MVI M,01H ;X=01H ASSUMED
	PUSH B
	LXI H,BOARD
	CALL CWIN
	POP B
	CPI 00H
	JNZ STOP	
	POP PSW
	RET
YMOVE:	PUSH PSW
	MVI M,0FFH ;X=01H ASSUMED
	PUSH B
	LXI H,BOARD
	CALL CWIN
	POP B
	CPI 00H
	JNZ STOP	
	POP PSW
	RET
STOP:	CALL UPDATE
	HLT
INVALID: POP PSW
	RAL 
	 INR B
	 RET
;----------------------------------------
INIT: PUSH H
	PUSH B
	LXI H,BOARD
	MVI C,08H
	MVI M,00H
INITL:	DAD B
	MVI M,00H
	DCR C
	JNZ INITL
	POP B
	POP H
	RET
;CONVERSION TABLE:
WINLIST:	.DB 00H,01H,01H
		.DB 03H,01H,01H
		.DB 06H,01H,01H
		.DB 00H,03H,03H
		.DB 01H,03H,03H
		.DB 02H,03H,03H
		.DB 00H,04H,04H
		.DB 02H,02H,02H
;BOARD STATE:
BOARD:		.DB 00H,00H,00H
		.DB 00H,00H,00H
		.DB 00H,00H,00H